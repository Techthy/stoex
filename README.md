# Stoex Language Interpreter

This project provides an interpreter for the Stoex (Stochastic Expressions) language, a domain-specific language for mathematical and stochastic computations.

## Features

The Stoex interpreter supports:

### Basic Data Types

- **Integers**: `42`, `-10`
- **Doubles**: `3.14`, `-2.5e10`
- **Booleans**: `true`, `false`
- **Strings**: `"hello world"`

### Arithmetic Operations

- **Addition**: `5 + 3`
- **Subtraction**: `10 - 4`
- **Multiplication**: `6 * 7`
- **Division**: `15 / 3`
- **Modulo**: `17 % 5`
- **Power**: `2 ^ 3`

### Boolean Operations

- **AND**: `true AND false`
- **OR**: `true OR false`
- **XOR**: `true XOR false`
- **NOT**: `NOT true`

### Comparison Operations

- **Greater than**: `5 > 3`
- **Less than**: `3 < 5`
- **Equal**: `5 == 5`
- **Not equal**: `5 <> 3`
- **Greater or equal**: `5 >= 3`
- **Less or equal**: `3 <= 5`

### Control Flow

- **If-else expressions**: `condition ? trueValue : falseValue`
- **Complex conditions**: `(x > 0 AND y > 0) ? "positive" : "negative"`

### Variables

- Support for variable assignment and reference
- Built-in constants: `PI`, `E`

### Built-in Functions

- **Mathematical functions**: `sin(x)`, `cos(x)`, `sqrt(x)`, `abs(x)`
- **Utility functions**: `max(a, b)`, `min(a, b)`

### Operator Precedence

The interpreter respects standard mathematical operator precedence:

1. Parentheses `()`
2. Power `^`
3. Unary operators `-`, `NOT`
4. Multiplication, Division, Modulo `*`, `/`, `%`
5. Addition, Subtraction `+`, `-`
6. Comparisons `>`, `<`, `==`, `<>`, `>=`, `<=`
7. Boolean AND `AND`
8. Boolean OR, XOR `OR`, `XOR`
9. Conditional `? :`

## Usage

### Basic Usage

```java
import tools.vitruv.stoex.interpreter.StoexInterpreter;
import tools.vitruv.stoex.stoex.Expression;

// Create interpreter
StoexInterpreter interpreter = new StoexInterpreter();

// Parse and evaluate expressions
Expression expr = parseExpression("2 + 3 * 4");
Object result = interpreter.evaluate(expr);
System.out.println(result); // 14.0
```

### Using Variables

```java
// Set variables
interpreter.setVariable("x", 10);
interpreter.setVariable("y", 20);

// Use variables in expressions
Expression expr = parseExpression("x + y * 2");
Object result = interpreter.evaluate(expr);
System.out.println(result); // 50.0
```

### Custom Initial Variables

```java
Map<String, Object> initialVars = new HashMap<>();
initialVars.put("radius", 5);
initialVars.put("height", 10);

StoexInterpreter interpreter = new StoexInterpreter(initialVars);
Expression expr = parseExpression("PI * radius ^ 2 * height");
Object result = interpreter.evaluate(expr);
System.out.println(result); // Volume of cylinder
```

## Building and Testing

### Prerequisites

- Java 17+
- Maven 3.6+

### Build the project

```bash
mvn clean compile
```

### Run tests

```bash
mvn test
```

### Run all tests including integration tests

```bash
mvn verify
```

### Run the demo

```bash
mvn exec:java -Dexec.mainClass="tools.vitruv.stoex.interpreter.StoexInterpreterDemo"
```

## Test Coverage

The interpreter includes comprehensive unit tests covering:

- ✅ All basic data types (integers, doubles, booleans, strings)
- ✅ All arithmetic operations (+, -, \*, /, %, ^)
- ✅ All boolean operations (AND, OR, XOR, NOT)
- ✅ All comparison operations (>, <, ==, <>, >=, <=)
- ✅ Conditional expressions (if-else)
- ✅ Variable support and undefined variable handling
- ✅ Built-in mathematical functions
- ✅ Built-in constants (PI, E)
- ✅ Operator precedence and parentheses
- ✅ Error handling (division by zero, unknown functions)
- ✅ Complex nested expressions
- ✅ Null input handling

**Test Results**: 48 tests, all passing ✅

## Example Expressions

```stoex
# Basic arithmetic
2 + 3 * 4                          # Result: 14.0

# Boolean logic
true AND false OR true             # Result: true

# Comparisons
5 > 3 AND 2 < 4                   # Result: true

# Conditional expressions
10 > 5 ? "greater" : "smaller"     # Result: "greater"

# Variables and functions
PI * radius ^ 2                    # Result: area of circle (radius = 5)

# Complex expressions
(x ^ 2 + y ^ 2) > 10 ? sqrt(x ^ 2 + y ^ 2) : x + y
```

## Architecture

The interpreter uses the Visitor pattern to traverse the Abstract Syntax Tree (AST) generated by Xtext:

1. **Parser**: Xtext generates parsers from the grammar definition
2. **AST**: Expression tree representing the parsed input
3. **Interpreter**: Recursively evaluates AST nodes
4. **Type Conversion**: Automatic conversion between numbers, booleans, and strings
5. **Variable Context**: HashMap-based variable storage
6. **Function Registry**: Built-in mathematical and utility functions

## Error Handling

The interpreter provides clear error messages for:

- Division by zero
- Undefined variables
- Unknown functions
- Type conversion errors
- Parse errors

## Future Extensions

The interpreter can be extended with:

- Custom function definitions
- More built-in functions (trigonometric, logarithmic)
- Variable scoping
- Arrays and collections
- Probability distribution sampling
- Performance optimizations
